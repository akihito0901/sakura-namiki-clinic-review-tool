// 口コミテンプレート集
const ReviewTemplates = {
    // 施術効果のテンプレート
    treatment: {
        5: [
            "めちゃくちゃ効果がありました",
            "本当に良くなりました",
            "かなり楽になりました",
            "想像以上に良かったです",
            "すごく改善しました",
            "痛みがだいぶ取れました",
            "体がすっきりしました",
            "調子が良くなりました",
            "効果バツグンでした",
            "とても良い感じでした"
        ],
        4: [
            "効果を実感できました",
            "だいぶ良くなりました",
            "しっかり治療してもらいました",
            "効果的な施術でした",
            "ちゃんと改善しました",
            "良い治療を受けました",
            "満足できる施術でした",
            "効果を感じられました",
            "的確な治療でした",
            "質の良い施術でした"
        ],
        3: [
            "施術してもらいました",
            "治療を受けました",
            "丁寧に診てもらいました",
            "しっかり施術を受けました",
            "治療していただきました",
            "通院しています",
            "施術を受けています",
            "定期的に通っています",
            "継続して治療を受けています",
            "お世話になっています"
        ]
    },

    // 院長対応のテンプレート
    staff: {
        5: [
            "今坂先生がめっちゃ良い人でした",
            "今坂院長の対応が最高でした",
            "今坂先生がすごく親切でした",
            "今坂先生の人柄がとても良いです",
            "今坂院長が丁寧に説明してくれました",
            "今坂先生がプロって感じでした",
            "今坂院長の人柄に癒されました",
            "今坂先生が本当に親切でした",
            "今坂院長を信頼できます",
            "今坂先生の真面目な感じが良かったです"
        ],
        4: [
            "今坂先生が丁寧でした",
            "今坂院長が親切にしてくれました",
            "今坂先生の説明が分かりやすかったです",
            "今坂院長がちゃんと対応してくれました",
            "今坂先生の人柄が良かったです",
            "今坂院長が優しかったです",
            "今坂先生が相談に乗ってくれました",
            "今坂院長の対応に満足しています",
            "今坂先生が詳しかったです",
            "今坂院長に安心して相談できました"
        ],
        3: [
            "今坂先生に診てもらいました",
            "今坂院長に対応してもらいました",
            "今坂先生に説明してもらいました",
            "今坂院長に診てもらいました",
            "今坂先生と話しました",
            "今坂院長に治療してもらいました",
            "今坂先生に相談しました",
            "今坂院長に診察してもらいました",
            "今坂先生に指導してもらいました",
            "今坂院長のところで治療を受けました"
        ]
    },

    // アクセスのテンプレート
    access: {
        5: [
            "駅からめっちゃ近いです",
            "アクセス最高でした",
            "立地がかなり良いです",
            "駅から歩いてすぐでした",
            "めっちゃ通いやすかったです",
            "場所がとても良いです",
            "アクセス抜群でした",
            "立地が最高です",
            "駅近でとても便利です",
            "駅からすぐで便利でした"
        ],
        4: [
            "駅から近くて便利です",
            "アクセスが良かったです",
            "立地が良いと思います",
            "通いやすい場所でした",
            "駅から近いから便利です",
            "駅近で良かったです",
            "立地がいい感じでした",
            "アクセスしやすかったです",
            "通いやすい立地でした",
            "駅からのアクセスが良いです"
        ],
        3: [
            "立地も悪くないです",
            "アクセスも問題ありませんでした",
            "駅からも歩ける距離でした",
            "通いやすい場所でした",
            "立地的にも通いやすかったです",
            "場所も分かりやすかったです",
            "アクセスもまあまあでした",
            "立地もそこそこでした",
            "交通の便も悪くなかったです",
            "通うのに問題ない立地でした"
        ]
    },

    // リラックス度のテンプレート
    relaxation: {
        5: [
            "院内がすごくリラックスできる感じでした",
            "落ち着いた雰囲気で心地よかったです",
            "リラックスできる環境が整ってて癒されました",
            "穏やかな雰囲気で安心して過ごせました",
            "心地よい空間でゆったりできました",
            "院内が清潔で居心地良かったです",
            "リラックスできる環境で集中できました",
            "温かい雰囲気で気持ちよく過ごせました",
            "落ち着ける空間で心が和みました",
            "癒しの空間で疲れが取れました"
        ],
        4: [
            "院内の雰囲気が良くてリラックスできました",
            "落ち着いた環境で過ごせました",
            "リラックスできる空間でした",
            "穏やかな雰囲気で安心できました",
            "居心地の良い院内でした",
            "清潔で快適な環境でした",
            "リラックスして治療を受けられました",
            "心地よい空間でした",
            "落ち着ける雰囲気でした",
            "癒される環境でした"
        ],
        3: [
            "院内も清潔で良かったです",
            "落ち着いた環境でした",
            "院内の雰囲気も悪くありませんでした",
            "清潔感のある院内でした",
            "過ごしやすい環境でした",
            "院内も整っていました",
            "快適に過ごせました",
            "環境も良好でした",
            "院内の設備も良かったです",
            "居心地も悪くありませんでした"
        ]
    },

    // 推薦意向のテンプレート
    recommendation: {
        5: [
            "友人にもぜひ今坂先生の整骨院を勧めたいです",
            "友達にも絶対おすすめしたい整骨院です",
            "周りの人にも今坂先生を紹介したくなります",
            "迷わず人に勧められる整骨院だと思います",
            "自信を持っておすすめできる院です",
            "家族にも今坂先生に診てもらいたいです",
            "絶対に人に勧めたくなる整骨院です",
            "心からおすすめできる今坂先生の院です",
            "もっと多くの人に知ってもらいたい整骨院です",
            "必ず人に紹介したい今坂先生の院です"
        ],
        4: [
            "知り合いにも勧めたい整骨院です",
            "友人にもおすすめしたいと思います",
            "人にも紹介したい今坂先生の院です",
            "おすすめできる整骨院だと思います",
            "推薦できる今坂先生の院です",
            "他の人にも勧めたい整骨院です",
            "人に勧めたくなる院です",
            "おすすめできる今坂先生の整骨院です",
            "紹介したい整骨院だと思います",
            "人に勧められる院だと感じました"
        ],
        3: [
            "また今坂先生にお世話になりたいです",
            "続けて通いたいと思います",
            "今後もお世話になりたいと思います",
            "また今坂先生の院に通いたいです",
            "引き続き利用させてもらいます",
            "これからも通いたいと思います",
            "また来院したいと思います",
            "継続して利用したいです",
            "今後ともよろしくお願いします",
            "また機会があれば利用したいです"
        ]
    },

    // 総合評価による接続詞
    connectors: {
        excellent: ["", "あと", "それと", "そして", ""],
        good: ["", "また", "それと", ""],
        average: ["", "また", ""]
    },

    // 開始パターン
    openings: [
        "桜並木駅前の整骨院に通院しました",
        "桜並木駅前の整骨院を利用しました", 
        "桜並木駅前の整骨院に行ってきました",
        "桜並木駅前の整骨院で治療を受けました",
        "桜並木駅前の整骨院にお世話になりました",
        "こちらの整骨院を利用させていただきました",
        "今坂先生の整骨院に通わせてもらいました",
        "桜並木駅前の整骨院で施術を受けました"
    ]
};

// ランダム選択ヘルパー関数
function getRandomElement(array) {
    return array[Math.floor(Math.random() * array.length)];
}

// 総合評価を計算
function calculateOverallRating(ratings) {
    const values = Object.values(ratings);
    const average = values.reduce((sum, val) => sum + val, 0) / values.length;
    
    if (average >= 4.5) return 'excellent';
    if (average >= 3.5) return 'good';
    return 'average';
}

// 口コミを生成する関数
function generateAdvancedReview(ratings) {
    const { treatment, staff, access, relaxation, recommendation } = ratings;
    const overallLevel = calculateOverallRating(ratings);
    
    let review = getRandomElement(ReviewTemplates.openings);
    
    const sentences = [];
    
    // 施術について
    if (treatment >= 3) {
        sentences.push(getRandomElement(ReviewTemplates.treatment[treatment]));
    }
    
    // スタッフ対応
    if (staff >= 3) {
        sentences.push(getRandomElement(ReviewTemplates.staff[staff]));
    }
    
    // アクセス
    if (access >= 3) {
        sentences.push(getRandomElement(ReviewTemplates.access[access]));
    }
    
    // リラックス度
    if (relaxation >= 3) {
        sentences.push(getRandomElement(ReviewTemplates.relaxation[relaxation]));
    }
    
    // 推薦意向
    if (recommendation >= 3) {
        sentences.push(getRandomElement(ReviewTemplates.recommendation[recommendation]));
    }
    
    // 文章を自然に繋げる
    if (sentences.length > 0) {
        if (sentences.length === 1) {
            review += sentences[0] + "。";
        } else if (sentences.length === 2) {
            review += sentences[0] + "。" + sentences[1] + "。";
        } else {
            // 3つ以上の場合は接続詞を使う
            review += sentences[0] + "。";
            for (let i = 1; i < sentences.length - 1; i++) {
                const connector = getRandomElement(ReviewTemplates.connectors[overallLevel]);
                review += (connector ? connector : "") + sentences[i] + "。";
            }
            review += sentences[sentences.length - 1] + "。";
        }
    }
    
    return review;
}